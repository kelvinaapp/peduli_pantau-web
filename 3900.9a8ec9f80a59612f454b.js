"use strict";(self.webpackChunkpantau_dashboard=self.webpackChunkpantau_dashboard||[]).push([[3900],{3900:(I,u,l)=>{l.r(u),l.d(u,{MonitoringPageModule:()=>A});var g=l(8583),v=l(665),p=l(2859),h=l(3955),c=l(4762),f=l(6738),m=l(4742),C=l(9036),b=l(1086),e=l(3018),M=l(1628),Z=l(2005);function P(a,d){if(1&a&&(e.TgZ(0,"ion-label",4),e._uU(1),e.qZA()),2&a){const i=d.$implicit;e.xp6(1),e.Oqu(i.label)}}function y(a,d){if(1&a){const i=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",5),e.NdJ("click",function(){const s=e.CHM(i).$implicit;return e.oxw().viewMonitorLog(s)}),e._uU(2),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4),e.qZA(),e.TgZ(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label"),e._uU(8),e.qZA(),e.TgZ(9,"ion-label"),e._uU(10),e.qZA(),e.TgZ(11,"ion-label"),e._uU(12),e.qZA(),e.TgZ(13,"ion-label",5),e.NdJ("click",function(){const s=e.CHM(i).$implicit;return e.oxw().openLocationLog(s)}),e._uU(14),e.qZA(),e.qZA()}if(2&a){const i=d.$implicit;e.xp6(2),e.Oqu(i.nik),e.xp6(2),e.Oqu(i.name),e.xp6(2),e.Oqu(i.bpm),e.xp6(2),e.hij("",i.spo2,"%"),e.xp6(2),e.hij("",i.temperature,"\xb0 C"),e.xp6(2),e.Oqu(i.formattedtime),e.xp6(2),e.AsE(" ",i.latitude,",",i.longitude," ")}}const T=[{path:"",component:(()=>{class a{constructor(i,t,o,s,n){this.storage=i,this.loadingController=t,this.modalController=o,this.firestore=s,this.toastController=n,this.column=[{label:"NIK"},{label:"Nama"},{label:"BPM"},{label:"Spo2"},{label:"Temperatur"},{label:"Waktu"},{label:"Koordinat"}],this.pasien=[],this.tmppasien=[]}ngOnInit(){this.loadData()}loadData(){m.Z.firestore().collection("pasien").get().then(i=>{i.empty?this.pasien=[]:(this.pasien=[],i.forEach(t=>{var o=t.data();o.id=t.id,o.nik&&this.pasien.push(o)}),this.getPasienSensor())})}getPasienSensor(){this.pasien.map((i,t)=>{m.Z.firestore().collection("pasien").doc(i.id).collection("measurement").orderBy("created_at","desc").limit(1).onSnapshot(o=>{o.empty||o.forEach(s=>{var n=s.data();n.formattedtime=f(n.created_at).format("DD MMM YYYY HH:mm:ss"),this.pasien[t].bpm=parseInt(n.heart_rate),this.pasien[t].spo2=parseInt(n.spo2),this.pasien[t].temperature=parseInt(n.body_temperature),this.pasien[t].formattedtime=n.formattedtime,this.checkAlert(i,n)})}),m.Z.firestore().collection("pasien").doc(i.id).collection("location").orderBy("timestamp","desc").limit(1).onSnapshot(o=>{o.empty||o.forEach(s=>{var n=s.data();n.formattedtime=f(n.timestamp).format("DD MMM YYYY HH:mm:ss"),this.pasien[t].latitude=n.coords.latitude,this.pasien[t].longitude=n.coords.longitude,this.pasien[t].accuracy=n.coords.accuracy})})}),this.tmppasien=this.pasien}checkAlert(i,t){return(0,c.__awaiter)(this,void 0,void 0,function*(){var o=parseInt(t.heart_rate),s=parseInt(t.spo2),n=parseInt(t.temp);if(o>100&&o<220)(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami penurunan/peningkatan detak jantung!",color:"warning",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present();else if(o<60||o>220)(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami penurunan/peningkatan detak jantung drastis!",color:"danger",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present();else if(s<95)(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami penurunan kadar saturasi oksigen!",color:"warning",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present();else if(s<90)(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami penurunan kadar satuasi oksigen drastis!",color:"danger",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present();else if(n>37.2&&n<38)(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami demam ! Suhu "+n,color:"warning",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present();else if(n<36.1||n>38){var r;(r=yield this.toastController.create({message:"Pasien bernama "+i.name+" mengalami demam tinggi!\n"+n+"&deg;C",color:"danger",position:"middle",buttons:[{side:"end",text:"OK",handler:()=>{r.dismiss()}}]})).present()}console.log("Checking alert:",i,t)})}openLocationLog(i){return(0,c.__awaiter)(this,void 0,void 0,function*(){(yield this.modalController.create({component:b.B,swipeToClose:!0,backdropDismiss:!1,componentProps:{onGoBack:()=>{this.loadData()},data:i}})).present()})}openMaps(i){window.open("https://www.google.com/maps/search/?api=1&query="+i.latitude+","+i.longitude,"_blank")}viewMonitorLog(i){return(0,c.__awaiter)(this,void 0,void 0,function*(){(yield this.modalController.create({component:C.g,swipeToClose:!0,backdropDismiss:!1,componentProps:{onGoBack:()=>{this.loadData()},data:i}})).present()})}search(i){const t=i.detail.value;if(console.log("Searching",t),this.pasien=this.tmppasien,t.includes(">")&&t.toLowerCase().includes("bpm")){var o=parseInt(t.split(">")[1]);this.pasien=this.pasien.filter(s=>s.bpm>o)}else t.includes("<")&&t.toLowerCase().includes("bpm")?(o=parseInt(t.split("<")[1]),this.pasien=this.pasien.filter(n=>n.bpm<o)):t.includes("=")&&t.toLowerCase().includes("bpm")?(o=parseInt(t.split("=")[1]),this.pasien=this.pasien.filter(n=>n.bpm==o)):t.includes(">")&&t.toLowerCase().includes("spo2")?(o=parseInt(t.split(">")[1]),this.pasien=this.pasien.filter(n=>n.spo2>o)):t.includes("<")&&t.toLowerCase().includes("spo2")?(o=parseInt(t.split("<")[1]),this.pasien=this.pasien.filter(n=>n.spo2<o)):t.includes("=")&&t.toLowerCase().includes("spo2")?(o=parseInt(t.split("=")[1]),this.pasien=this.pasien.filter(n=>n.spo2==o)):t.includes(">")&&t.toLowerCase().includes("temp")?(o=parseInt(t.split(">")[1]),this.pasien=this.pasien.filter(n=>n.temperature>o)):t.includes("<")&&t.toLowerCase().includes("temp")?(o=parseInt(t.split("<")[1]),this.pasien=this.pasien.filter(n=>n.temperature<o)):t.includes("=")&&t.toLowerCase().includes("temp")?(o=parseInt(t.split("=")[1]),this.pasien=this.pasien.filter(n=>n.temperature==o)):(console.log("Checking on else"),this.pasien=this.pasien.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())||s.nik.toString().includes(t.toLowerCase())))}}return a.\u0275fac=function(i){return new(i||a)(e.Y36(M.K),e.Y36(p.HT),e.Y36(p.IN),e.Y36(Z.ST),e.Y36(p.yF))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-monitoring"]],decls:10,vars:2,consts:[["showCancelButton","focus","placeholder","Cari",3,"ionChange"],[1,"ion-padding"],["style","font-weight: bold",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"font-weight","bold"],["color","primary",2,"cursor","pointer",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-title"),e._uU(3,"Monitoring"),e.qZA(),e.qZA(),e.TgZ(4,"ion-searchbar",0),e.NdJ("ionChange",function(s){return t.search(s)}),e.qZA(),e.qZA(),e.TgZ(5,"ion-content",1),e.TgZ(6,"ion-item"),e.YNc(7,P,2,1,"ion-label",2),e.qZA(),e.TgZ(8,"ion-list"),e.YNc(9,y,15,8,"ion-item",3),e.qZA(),e.qZA()),2&i&&(e.xp6(7),e.Q6J("ngForOf",t.column),e.xp6(2),e.Q6J("ngForOf",t.pasien))},directives:[p.Gu,p.sr,p.wd,p.VI,p.j9,p.W2,p.Ie,g.sg,p.q_,p.Q$],styles:["ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{justify-content:center;text-align:center;align-self:auto;margin:5px}"]}),a})()}];let w=(()=>{class a{}return a.\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[h.Bz.forChild(T)],h.Bz]}),a})(),A=(()=>{class a{}return a.\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[g.ez,v.u5,p.Pc,w]]}),a})()}}]);